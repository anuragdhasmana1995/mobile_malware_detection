import pickle
import pandas as pd


sorted_permissions_benign = []
final_unique_permissions = []
sorted_apis_benign = []
final_unique_apis = []
benign_apis = [[]]
benign_permissions = [[]]

##with open('saved_items/benign_permissions.pickle' , 'rb') as handle:
##    sorted_permissions_benign = pickle.load(handle)
##
##with open('saved_items/benign_api_calls.pickle' , 'rb') as handle:
##    sorted_apis_benign = pickle.load(handle)
##
##with open('saved_items/benign_apis_list.pickle' , 'rb') as handle:
##    benign_apis = pickle.load(handle)
##
##with open('saved_items/benign_permissions_list.pickle' , 'rb') as handle:
##    benign_permissions = pickle.load(handle)
##
####for key in sorted_permissions_benign:
####    final_unique_permissions.append(key[0])
##
##for key in sorted_apis_benign:
##    final_unique_apis.append(key[0])
    
##df1 = pd.read_csv(r'C:\Users\Anurag\Documents\GitHub\mobile_malware_detection\program\csv\combined_permissions.csv',index_col = 0)
##
##print(df1.shape)
##
##df2 = pd.DataFrame(columns = final_unique_permissions)
##
##print(len(sorted_permissions_benign))
##print(df2.shape)
##
##count = 0 
##for apk_perms in benign_permissions:
##    row = [0 for _ in final_unique_permissions]
##    for perm in apk_perms:
##        index = final_unique_permissions.index(perm)
##        row[index] = 1
##    df2.loc[count] = row
##    count+=1
##
##df2['type'] = 0
##print(df2.shape)
##
##df1 = df1.append(df2)
##print(df1.shape)
##
##df1.fillna(0,inplace=True)
##df1 = df1.loc[: , (df1!=0).any(axis=0)]
##
##
##print(df1.shape)
##
##df1.to_csv(r'csv\final_permissions_combined.csv')

#combining all apis

##print((len(sorted_apis_benign)))

##df1 = pd.read_csv(r'csv\all_malicious_apis.csv',index_col =0)
##
##df1['type'] = 1
##print(df1.shape)
##
##df2 = pd.DataFrame(columns = final_unique_apis)
##
##print(df2.shape)
##
##count = 0 
##for apk_apis in benign_apis:
##    row = [0 for _ in final_unique_apis]
##    for api in apk_apis:
##        index = final_unique_apis.index(api)
##        row[index] = 1
##    df2.loc[count] = row
##    count+=1
##
##print(df2.shape)
##
##df2['type'] = 0



##df1 = df1.append(df2)
##print(df1.shape)
##
##df1.fillna(0,inplace=True)
##df1 = df1.loc[: , (df1!=0).any(axis=0)]
##print(df1.shape)
##
##df1.to_csv(r'csv\final_apis_combined.csv')

##df1 = pd.read_csv(r'csv\final_apis_combined.csv',index_col =0)
##df2 = df1.iloc[0:79]
##df3 = df1.iloc[79:]
##
####print(df2['type'])
####print(df3['type'])
##
##df2 = pd.concat([df2]*3)
##df2 = df2.sample(n=199).reset_index(drop=True)
####print(df2.shape)
##
##df3 = pd.concat([df3]*3)
##df3 = df3.sample(n=199).reset_index(drop=True)
####print(df3.shape)
##
##
##df1 = pd.concat([df3, df1], ignore_index=True)
##df1 = pd.concat([df2, df1], ignore_index=True)
##
##print(df1.shape)
##print(df1['type'])
df1 = pd.read_csv(r'csv\temp_final_apis.csv' , index_col = 0)
##
####df4 = pd.read_csv(r'csv\final_permissions_combined.csv',index_col =0)
####print(df4.shape)
####print(df4['type'])
df4 = pd.read_csv(r'csv\temp_final_permissions.csv', index_col = 0)
##
##
##
##
####print(df1.shape)
####print(df4.shape)
##
df4 = df4.join(df1 , lsuffix='_left', rsuffix='_right').reset_index(drop=True)
print(df4.shape)

df4.fillna(0,inplace=True)
df4 = df4.loc[: , (df4!=0).any(axis=0)]

##print(df4.shape)
##print(df4['type_left'])
##print(df4['type_right'])

print(df4.shape)
df4.drop(['type_right'], axis = 1, inplace = True)
print(df4.shape)
df4 =df4.rename(columns = {'type_left':'type'})
##print(df4['type'])
print(df4[df4['type'] == 0].count())

df4.to_csv(r'csv\final_training_set.csv')
##print(df4.head())









