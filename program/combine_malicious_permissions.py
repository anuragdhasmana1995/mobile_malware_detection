import pandas as pd
from androguard.core.bytecodes.apk import APK
import pickle
import os

permissions = {}
permissions_list = []
count = 0
file_names = []
file_paths = []


def collect_perms(perms):
    row = [0 for x in range(len(permissions_list))]
    for perm in perms:
        index = permissions_list.index(perm)
        row[index] = 1
    return row

def get_permissions(path):
    application = APK(path)
    permissions = application.get_permissions()
    permissions = list(set(permissions))
    return permissions

##with open(r'saved_items\permissions.pickle' , 'rb') as handle:
##	permissions = pickle.load(handle)
##
##for key in permissions:
##    permissions_list.append(key[0])
##
##print((permissions_list))
##
##df = pd.DataFrame(columns = permissions_list)
##
##
##
##
##for root,dirs,files in os.walk(r'C:\Users\Anurag\Desktop\Research@MAJOR\malicious_apks'):
##    file_names.append((files))
##    
##for f in file_names[0]:
##    path = 'C:\Users\Anurag\Desktop\Research@MAJOR\malicious_apks\\' + '\\' + str(f)
##    file_paths.append(path)
##
##
##for path in file_paths:
##    print('reading ' + str(count+1) + ' file' , path)
##    perms = get_permissions(path)
##    row = collect_perms(perms)
##    df.loc[count] = row
##    count+=1
##
##df['type'] = 1
##df.to_csv('malicious_apks.csv')

##df1 = pd.read_csv('refined_training.csv',index_col =0)
##df2 = pd.read_csv('malicious_apks.csv',index_col =0)
##
##
##print(len(df1.columns))
##print(len(df2.columns))
##
##
##
##df3 = df1.append(df2)
##
##df3.fillna(0,inplace=True)
##
##print(len(df3.columns))
##
##df3 = df3.loc[: , (df3!=0).any(axis=0)]
##print(len(df3.columns))
##
##df3.to_csv('combined_malicious_permissions.csv')
##
##df1 = pd.read_csv('combined_malicious_permissions.csv',index_col =0)
##print(len(df1.columns))





