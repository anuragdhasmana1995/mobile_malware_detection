#!/usr/bin/env bash

PROJECT_DIR="/Common45/research"
TMP_FILE="$PROJECT_DIR/tmp/tmp.txt"

TRAINING_DATA=$1
OUTPUT_FILE=$2

echo "{" > $OUTPUT_FILE

for (( i = 2; i <= 200; i = i + 1 ))
do
  echo "Round $i"

  # Cross-validation
  #java weka.classifiers.meta.FilteredClassifier \
  #  -F "weka.filters.unsupervised.attribute.Remove -R $i-200" \
  #  -W weka.classifiers.bayes.NaiveBayes \
  #  -t $TRAINING_DATA -i -o > $TMP_FILE

  # Cross-validation
  java weka.classifiers.meta.FilteredClassifier \
    -F "weka.filters.MultiFilter
      -F \"weka.filters.unsupervised.attribute.Remove
        -R $i-200\"
      -F \"weka.filters.unsupervised.attribute.PrincipalComponents
        -R 0.95 -A 5 -M -1\"
      -F \"weka.filters.unsupervised.attribute.Discretize
        -F -B 30 -M -1.0 -R first-last\"" \
    -W weka.classifiers.bayes.HNB \
    -t $TRAINING_DATA -i -o > $TMP_FILE

  # Get the accuracy and error rate.
  tmp=($(cat $TMP_FILE | tail -n 24 | head -n 2 | cut -c 58-64))
  acc=${tmp[0]}
  err=${tmp[1]}

  # Get the accuracy and error rate.
  tmp=($(cat $TMP_FILE | tail -n 10 | head -n 1))
  tpr=${tmp[0]}
  fpr=${tmp[1]}
  aor=${tmp[5]}

  echo -n "  \"$(( i - 1 ))\": [$acc, $err, $tpr, $fpr, $aor]" \
    >> $OUTPUT_FILE
  if [ $i -eq 200 ]; then
    echo "" >> $OUTPUT_FILE
  else
    echo "," >> $OUTPUT_FILE
  fi
done

echo "}" >> $OUTPUT_FILE

exit 0
